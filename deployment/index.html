
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://lnynhi02.github.io/stream-processing-pipeline-docs/deployment/">
      
      
        <link rel="prev" href="../changelog/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.9">
    
    
      
        <title>Deployment - New York City Yellow Trip Stream Processing</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#new-york-city-yellow-trip-stream-processing" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="New York City Yellow Trip Stream Processing" class="md-header__button md-logo" aria-label="New York City Yellow Trip Stream Processing" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            New York City Yellow Trip Stream Processing
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Deployment
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="New York City Yellow Trip Stream Processing" class="md-nav__button md-logo" aria-label="New York City Yellow Trip Stream Processing" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    New York City Yellow Trip Stream Processing
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../changelog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Deployment
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Deployment
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#achievements" class="md-nav__link">
    <span class="md-ellipsis">
      Achievements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      üìï Table Of Contents
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#local-setup" class="md-nav__link">
    <span class="md-ellipsis">
      ‚öôÔ∏è Local Setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="‚öôÔ∏è Local Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dataset" class="md-nav__link">
    <span class="md-ellipsis">
      Dataset
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment" class="md-nav__link">
    <span class="md-ellipsis">
      üíª Deployment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üíª Deployment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#execution-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Execution Overview üé¨
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#postgres-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Postgres Setup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kafka-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Kafka Setup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spark-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Spark Setup
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/lnynhi02/Stream-Processing-Pipeline" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitHub Repository
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#achievements" class="md-nav__link">
    <span class="md-ellipsis">
      Achievements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      üìï Table Of Contents
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#local-setup" class="md-nav__link">
    <span class="md-ellipsis">
      ‚öôÔ∏è Local Setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="‚öôÔ∏è Local Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dataset" class="md-nav__link">
    <span class="md-ellipsis">
      Dataset
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment" class="md-nav__link">
    <span class="md-ellipsis">
      üíª Deployment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üíª Deployment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#execution-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Execution Overview üé¨
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#postgres-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Postgres Setup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kafka-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Kafka Setup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spark-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Spark Setup
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<div><h1 id="new-york-city-yellow-trip-stream-processing"><strong><em>New York City Yellow Trip Stream Processing</em></strong></h1>
<p>This reference architecture shows an <strong><em>end-to-end real-time analytics pipeline</em></strong> utilizing ETL (Extract, Transform, Load) processes. The pipeline will ingest data from a source, perform necessary transformations and computations, and load it into storage for future purposes.</p>
<p><strong><em>Scenario</em></strong>: A taxi company that has collected yellow taxi trip data in New York City. The dataset includes several fields such as total_amount, dropoff_location, pickup_location, and trip_distance. There is also a lookup file containing boroughs and zones based on location_id. To analyze trip trends in real-time, the company aims to calculate the number of trips, average revenue per hour,... and detect abnormal trips as early as possible.</p>
<h2 id="overview"><strong>Overview</strong></h2>
<p>The following is the structure of the data pipeline:</p>
<p><img alt="Image" src="../img/pipeline-1.gif"></p>
<h2 id="achievements"><strong>Achievements</strong></h2>
<ul>
<li>Detects abnormal trip durations (e.g., less than 1 minute, more than 2 hours) and identifies discrepancies between the actual and calculated amounts.</li>
<li>Calculates average revenue and trip counts per hour, categorized by payment type and borough.</li>
<li>Configures Spark session with optimized parameters, including custom shuffle partitions and broadcast joins for efficient processing.</li>
<li>Provides a dynamic dashboard for monitoring and analyzing trends each day.</li>
<li>Efficiently writes large-scale processed streaming data to PostgreSQL in near real-time.</li>
</ul>
<p><div class="video-container"><video style="position:relative;width:100%;height:22.172vw" muted controls alt="type:video"><source src="../img/dashboard.mp4" type="video/mp4"></source></video></div></p>
<h2 id="table-of-contents"><strong>üìï Table Of Contents</strong></h2>
<ul>
<li><a href="#local-setup">‚öôÔ∏è Local Setup</a></li>
<li><a href="#deployment">üíª Deployment</a><ul>
<li><a href="#postgres-setup">Postgres Setup</a></li>
<li><a href="#kafka-setup">Kafka Setup</a></li>
<li><a href="#spark-setup">Spark Setup</a></li>
</ul>
</li>
<li><a href="#summary">Summary</a></li>
</ul>
<p>The sequence to run the script is: <code>create_table.py</code> -&gt; <code>spark_streaming.py</code> -&gt; <code>kafka_stream.py</code></p>
<h2 id="local-setup"><strong>‚öôÔ∏è Local Setup</strong></h2>
<h3 id="dataset"><strong>Dataset</strong></h3>
<p>The company has shared with you 3 key datasets for this data.</p>
<details>
<summary>üöï New York Yellow Taxi Dataset</summary>
<p>The data file is too large to push it to GitHub. Therefore, please press below to download the zip file and extract it to the <code>data/</code> folder of the project directory. Otherwise, you can place it anywhere you want.</p>
<p></p><li><a href="https://drive.google.com/file/d/1mT3UTHNjPHGxKTQLuipTNqGLAsXInG9R/view" target="_blank">yellow_tripdata_2024.csv</a></li>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>VendorID</td>
<td>A code indicating the TPEP provider that provided the record. 1= Creative Mobile Technologies, LLC; 2= VeriFone Inc.</td>
</tr>
<tr>
<td>tpep_pickup_datetime</td>
<td>The date and time when the meter was engaged.</td>
</tr>
<tr>
<td>tpep_dropoff_datetime</td>
<td>The date and time when the meter was disengaged.</td>
</tr>
<tr>
<td>Passenger_count</td>
<td>The number of passengers in the vehicle. This is a driver-entered value.</td>
</tr>
<tr>
<td>Trip_distance</td>
<td>The elapsed trip distance in miles reported by the taximeter.</td>
</tr>
<tr>
<td>PULocationID</td>
<td>TLC Taxi Zone in which the taximeter was engaged.</td>
</tr>
<tr>
<td>DOLocationID</td>
<td>TLC Taxi Zone in which the taximeter was disengaged.</td>
</tr>
<tr>
<td>RateCodeID</td>
<td>The final rate code in effect at the end of the trip.<br>1= Standard rate <br>2= JFK <br>3= Newark <br>4= Nassau or Westchester <br>5= Negotiated fare <br>6= Group ride</td>
</tr>
<tr>
<td>Store_and_fwd_flag</td>
<td>Indicates whether the trip record was held in vehicle memory before sending to the vendor due to no server connection.<br>Y = Store and forward trip <br>N = Not a store and forward trip</td>
</tr>
<tr>
<td>Payment_type</td>
<td>A numeric code signifying how the passenger paid for the trip.<br>1= Credit card <br>2= Cash <br>3= No charge <br>4= Dispute <br>5= Unknown <br>6= Voided trip</td>
</tr>
<tr>
<td>Fare_amount</td>
<td>The time-and-distance fare calculated by the meter.</td>
</tr>
<tr>
<td>Extra</td>
<td>Miscellaneous extras and surcharges, including $0.50 and $1 rush hour and overnight charges.</td>
</tr>
<tr>
<td>MTA_tax</td>
<td>$0.50 MTA tax automatically triggered based on the metered rate in use.</td>
</tr>
<tr>
<td>Improvement_surcharge</td>
<td>$0.30 improvement surcharge assessed at flag drop. This began in 2015.</td>
</tr>
<tr>
<td>Tip_amount</td>
<td>Tip amount. Automatically populated for credit card tips; cash tips are not included.</td>
</tr>
<tr>
<td>Tolls_amount</td>
<td>Total amount of all tolls paid in trip.</td>
</tr>
<tr>
<td>Total_amount</td>
<td>The total amount charged to passengers. Does not include cash tips.</td>
</tr>
<tr>
<td>Congestion_Surcharge</td>
<td>Total amount collected in trip for NYS congestion surcharge.</td>
</tr>
<tr>
<td>Airport_fee</td>
<td>$1.25 for pick up only at LaGuardia and John F. Kennedy Airports.</td>
</tr>
</tbody>
</table>
</details>
<details>
<summary>üîç Taxi Zone Lookup Table</summary>
<p>This data is used to support the development of dashboard analyses in Power BI.**
</p><li><a href="https://github.com/lnynhi02/Stream-Processing-Pipeline/blob/main/data/taxi_zone_lookup.csv" target="_blank">taxi_zone_lookup</a></li>
</details>
<details>
<summary>üó∫Ô∏è Taxi Zone Shapefile</summary>
<p>This data is used to support the development of dashboard analyses in Power BI.
</p><li><a href="https://github.com/lnynhi02/Stream-Processing-Pipeline/tree/main/data/taxi_zones" target="_blank">taxi_zone_shapefile</a></li>
</details>
<h3 id="prerequisites"><strong>Prerequisites</strong></h3>
<ul>
  <li>Install <a href="https://www.docker.com/products/docker-desktop/" target="_blank">Docker</a> for running Kafka</li>
  <li>Install <a href="https://www.oracle.com/java/technologies/downloads/?er=221886" target="_blank">JDK</a></li>
  <li>Install <a href="https://spark.apache.org/downloads.html" target="_blank">Spark</a></li>
  <li>Install <a href="https://www.python.org/" target="_blank">Python</a></li>
  <li>Install <a href="https://www.postgresql.org/download/" target="_blank">PostgreSQL</a></li>
</ul>

<blockquote>
<p><strong>Apache Spark is only compatible with Java 8, Java 11, or Java 17.</strong></p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="c1"># Clone the repository</span>
<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/lnynhi02/Data-Pipeline-Project.git
</code></pre></div>
<p><strong>Here is the overall structure of the project:</strong></p>
<div class="highlight"><pre><span></span><code>Project Directory
|
‚îú‚îÄ‚îÄ data
‚îÇ   ‚îú‚îÄ‚îÄ yellow_tripdata_2024.csv
‚îÇ   ‚îú‚îÄ‚îÄ taxi_zone_lookup.csv
‚îÇ   ‚îî‚îÄ‚îÄ taxi_zone_shapefile
|
‚îú‚îÄ‚îÄ config
‚îÇ   ‚îú‚îÄ‚îÄ config.ini          # includes the configuration of PostgreSQL, Kafka, and email alerts
‚îÇ   ‚îú‚îÄ‚îÄ index.txt           # the number of messages sent
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt
|
‚îú‚îÄ‚îÄ src
‚îÇ   ‚îú‚îÄ‚îÄ utils.py            # contains helper functions, such as sending email alerts
‚îÇ   ‚îú‚îÄ‚îÄ kafka_stream.py     # streams data from Kafka topic
‚îÇ   ‚îî‚îÄ‚îÄ spark_streaming.py  # processes streamed data using Spark Streaming
|
‚îú‚îÄ‚îÄ tmp
‚îÇ   ‚îú‚îÄ‚îÄ sql_warehouse
‚îÇ   ‚îú‚îÄ‚îÄ local_dir
‚îÇ   ‚îî‚îÄ‚îÄ checkpoint          # Spark Streaming checkpoints
‚îÇ       ‚îú‚îÄ‚îÄ full_table_data
‚îÇ       ‚îú‚îÄ‚îÄ abnormal_fee
‚îÇ       ‚îú‚îÄ‚îÄ abnormal_duration
‚îÇ       ‚îú‚îÄ‚îÄ avg_revenue_per_hour
‚îÇ       ‚îú‚îÄ‚îÄ trip_count_per_hour
‚îÇ       ‚îî‚îÄ‚îÄ trip_count_by_borough
|
‚îî‚îÄ‚îÄ docker-compose.yaml     # used to run Kafka and Kafka UI services
</code></pre></div>
<h2 id="deployment"><strong>üíª Deployment</strong></h2>
<h3 id="execution-overview">Execution Overview üé¨</h3>
<p>Before setting up the environment, here‚Äôs a quick demo of the pipeline in action:
üìΩÔ∏è</p>
<p><div class="video-container"><video style="position:relative;width:100%;height:22.172vw" muted controls alt="type:video"><source src="../img/full-deploy.mp4" type="video/mp4"></source></video></div></p>
<h3 id="postgres-setup">Postgres Setup</h3>
<p>Before setting up our Spark and Airflow configurations, let‚Äôs create the Postgres database that will persist our data. I prefer using the <strong>pgAdmin 4</strong> tool for this; however, any other Postgres development platform can do the job.</p>
<p>When installing Postgres, you need to set up a password that we will need later to connect to the database from the Spark environment. <strong>You must remember the password to reconnect to the database servers.</strong> You can also leave the port at 5432.</p>
<p>You can create your database for the project in the pgAdmin4 or run the PostgreSQL script to create the database:</p>
<p><img alt="Image" src="../img/postgres.png"></p>
<h3 id="kafka-setup">Kafka Setup</h3>
<p>To avoid resending messages that have already been processed each time we run the streaming task, we define an <code>index.txt</code> file that records the number of messages sent in the latest streaming session.</p>
<p>The code for the Kafka streaming task can be found in <code>src/kafka_stream.py</code>, which involves extracting data from a CSV file, serving the data to a Kafka topic using a Kafka producer, and updating the numbers in <code>index.txt</code>.</p>
<p>Run the Kafka service defined in the <code>docker-compose.yaml</code> file:</p>
<div class="highlight"><pre><span></span><code>docker-compose up -d
</code></pre></div>
<p>After the services start, visit the Kafka UI at http://localhost:8800/:
<img alt="Image" src="../img/kafka-ui.png"></p>
<p>Create a topic named <em>yellow_tripdata</em> with:</p>
<ul>
<li><em>Replication factor</em> set to 1</li>
<li><em>Partitions</em> set to 10</li>
<li><em>Data retention</em> set to a small number.</li>
</ul>
<h3 id="spark-setup">Spark Setup</h3>
<p>The goal of the Spark jobs is to consume the streaming data from the Kafka topic <strong>yellow_tripdata</strong> and then transfer it to the Postgres tables.</p>
<p>The complete code for the Spark jobs is in the <code>src/spark_streaming.py</code> file.</p>
<ul>
<li>
<p>Create the Spark Session:
</p><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">create_sparksession</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">SparkSession</span><span class="p">:</span>
    <span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span> \
            <span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">"KafkaToPostgres"</span><span class="p">)</span> \
            <span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s2">"spark.sql.shuffle.partitions"</span><span class="p">,</span> <span class="s2">"9"</span><span class="p">)</span> \
            <span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s2">"spark.sql.warehouse.dir"</span><span class="p">,</span> <span class="s2">"tmp/sql_warehouse"</span><span class="p">)</span> \
            <span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s2">"spark.local.dir"</span><span class="p">,</span> <span class="s2">"tmp/local_dir"</span><span class="p">)</span> \
            <span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">spark</span>
</code></pre></div>
</li>
<li>
<p>Read Kafka stream and apply schema:
</p><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">create_schema</span><span class="p">(</span><span class="n">streaming_df</span><span class="p">):</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="n">StructType</span><span class="p">([</span>
        <span class="n">StructField</span><span class="p">(</span><span class="s1">'VendorID'</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
        <span class="n">StructField</span><span class="p">(</span><span class="s1">'tpep_pickup_datetime'</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
        <span class="n">StructField</span><span class="p">(</span><span class="s1">'tpep_dropoff_datetime'</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
        <span class="n">StructField</span><span class="p">(</span><span class="s1">'passenger_count'</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
        <span class="n">StructField</span><span class="p">(</span><span class="s1">'trip_distance'</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
        <span class="n">StructField</span><span class="p">(</span><span class="s1">'RatecodeID'</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
        <span class="n">StructField</span><span class="p">(</span><span class="s1">'store_and_fwd_flag'</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
        <span class="n">StructField</span><span class="p">(</span><span class="s1">'PULocationID'</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
        <span class="n">StructField</span><span class="p">(</span><span class="s1">'DOLocationID'</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
        <span class="n">StructField</span><span class="p">(</span><span class="s1">'payment_type'</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
        <span class="n">StructField</span><span class="p">(</span><span class="s1">'fare_amount'</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
        <span class="n">StructField</span><span class="p">(</span><span class="s1">'extra'</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
        <span class="n">StructField</span><span class="p">(</span><span class="s1">'mta_tax'</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
        <span class="n">StructField</span><span class="p">(</span><span class="s1">'tip_amount'</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
        <span class="n">StructField</span><span class="p">(</span><span class="s1">'tolls_amount'</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
        <span class="n">StructField</span><span class="p">(</span><span class="s1">'improvement_surcharge'</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
        <span class="n">StructField</span><span class="p">(</span><span class="s1">'total_amount'</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
        <span class="n">StructField</span><span class="p">(</span><span class="s1">'congestion_surcharge'</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
        <span class="n">StructField</span><span class="p">(</span><span class="s1">'Airport_fee'</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">)</span>
    <span class="p">])</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">streaming_df</span><span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span><span class="s2">"CAST(value AS String)"</span><span class="p">)</span>\
        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">from_json</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'value'</span><span class="p">),</span> <span class="n">schema</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'data'</span><span class="p">))</span>\
        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">'data.*'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div>
</li>
<li>
<p>In the previous version of the pipeline, I didn't change the column types at the beginning. However, for this version, I've changed the data types upfront, so we no longer need to cast the data types during real-time analysis.
</p><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">column_types</span><span class="p">(</span><span class="n">df_stream</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df_stream</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
        <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"VendorID"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">""</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"VendorID"</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">"int"</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"vendor_id"</span><span class="p">),</span>
        <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"tpep_pickup_datetime"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">""</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">to_timestamp</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"tpep_pickup_datetime"</span><span class="p">)))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"pickup_datetime"</span><span class="p">),</span>
        <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"tpep_dropoff_datetime"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">""</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">to_timestamp</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"tpep_dropoff_datetime"</span><span class="p">)))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"dropoff_datetime"</span><span class="p">),</span>
        <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"passenger_count"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">""</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"passenger_count"</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">"int"</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"passenger_count"</span><span class="p">),</span>
        <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"trip_distance"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">""</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"trip_distance"</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">"double"</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"trip_distance"</span><span class="p">),</span>
        <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"RatecodeID"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">""</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"RatecodeID"</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">"int"</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"ratecode_id"</span><span class="p">),</span>
        <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"PULocationID"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">""</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"PULocationID"</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">"int"</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"pu_location_id"</span><span class="p">),</span>
        <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"DOLocationID"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">""</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"DOLocationID"</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">"int"</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"do_location_id"</span><span class="p">),</span>
        <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"payment_type"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">""</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"payment_type"</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">"int"</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"payment_type"</span><span class="p">),</span>
        <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"fare_amount"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">""</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"fare_amount"</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">"double"</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"fare_amount"</span><span class="p">),</span>
        <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"extra"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">""</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"extra"</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">"double"</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"extra"</span><span class="p">),</span>
        <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"mta_tax"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">""</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"mta_tax"</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">"double"</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"mta_tax"</span><span class="p">),</span>
        <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"tip_amount"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">""</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"tip_amount"</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">"double"</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"tip_amount"</span><span class="p">),</span>
        <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"tolls_amount"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">""</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"tolls_amount"</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">"double"</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"tolls_amount"</span><span class="p">),</span>
        <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"improvement_surcharge"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">""</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"improvement_surcharge"</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">"double"</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"improvement_surcharge"</span><span class="p">),</span>
        <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"total_amount"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">""</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"total_amount"</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">"double"</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"total_amount"</span><span class="p">),</span>
        <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"congestion_surcharge"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">""</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"congestion_surcharge"</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">"double"</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"congestion_surcharge"</span><span class="p">),</span>
        <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"Airport_fee"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">""</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"Airport_fee"</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">"double"</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"airport_fee"</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div>
</li>
<li>And by selecting only the columns needed for the analysis, we can improve performance and avoid scanning unnecessary columns, which helps reduce the read and write data volume.
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">select_column</span><span class="p">(</span><span class="n">df_parsed</span><span class="p">):</span>
    <span class="n">df_main</span> <span class="o">=</span> <span class="n">df_parsed</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
        <span class="s2">"pickup_datetime"</span><span class="p">,</span> <span class="s2">"dropoff_datetime"</span><span class="p">,</span> <span class="s2">"total_amount"</span><span class="p">,</span> <span class="s2">"payment_type"</span>
    <span class="p">)</span>

    <span class="n">df_extra</span> <span class="o">=</span> <span class="n">df_parsed</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
        <span class="s2">"pickup_datetime"</span><span class="p">,</span> <span class="s2">"dropoff_datetime"</span><span class="p">,</span> <span class="s2">"total_amount"</span><span class="p">,</span> <span class="s2">"payment_type"</span><span class="p">,</span>
        <span class="s2">"pu_location_id"</span><span class="p">,</span> <span class="s2">"do_location_id"</span><span class="p">,</span> <span class="s2">"fare_amount"</span><span class="p">,</span> <span class="s2">"extra"</span><span class="p">,</span> <span class="s2">"mta_tax"</span><span class="p">,</span> 
        <span class="s2">"tip_amount"</span><span class="p">,</span> <span class="s2">"tolls_amount"</span><span class="p">,</span> <span class="s2">"improvement_surcharge"</span><span class="p">,</span> <span class="s2">"airport_fee"</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">df_main</span><span class="p">,</span> <span class="n">df_extra</span>
</code></pre></div></li>
</ul>
<hr>
<p>The following are some functions I use to analyze real-time data trends using <strong>Spark Structured Streaming</strong> and <strong>Window functions</strong>.</p>
<ol>
<li>
<p>One of the functions is <code>detect_abnormal_fee</code> used to detect trips with abnormal fees, such as discrepancies between the total_amount and the calculated amount from summing individual fee components. Moreover, in this version, I‚Äôve added an alert system that can immediately notify whenever an abnormal trip is detected.</p>
<ul>
<li>At first, I attempted to detect abnormal trip durations and add alert using the following code:
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">detect_abnormal_fee</span><span class="p">(</span><span class="n">df_extra</span><span class="p">):</span>
    <span class="n">abnormal_fee</span> <span class="o">=</span> <span class="n">df_extra</span> \
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"caculated_total_amount"</span><span class="p">,</span> 
                    <span class="n">col</span><span class="p">(</span><span class="s2">"fare_amount"</span><span class="p">)</span> <span class="o">+</span>
                    <span class="n">col</span><span class="p">(</span><span class="s2">"extra"</span><span class="p">)</span> <span class="o">+</span>
                    <span class="n">col</span><span class="p">(</span><span class="s2">"mta_tax"</span><span class="p">)</span> <span class="o">+</span>
                    <span class="n">col</span><span class="p">(</span><span class="s2">"tip_amount"</span><span class="p">)</span> <span class="o">+</span>
                    <span class="n">col</span><span class="p">(</span><span class="s2">"tolls_amount"</span><span class="p">)</span> <span class="o">+</span>
                    <span class="n">col</span><span class="p">(</span><span class="s2">"improvement_surcharge"</span><span class="p">)</span> <span class="o">+</span>
                    <span class="n">col</span><span class="p">(</span><span class="s2">"airport_fee"</span><span class="p">))</span> \
        <span class="o">.</span><span class="n">filter</span><span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"total_amount"</span><span class="p">)</span> <span class="o">-</span> <span class="n">col</span><span class="p">(</span><span class="s2">"caculated_total_amount"</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"total_amount"</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">()))</span> \
        <span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span>
            <span class="s2">"pickup_datetime"</span><span class="p">,</span> 
            <span class="s2">"dropoff_datetime"</span><span class="p">,</span> 
            <span class="s2">"pu_location_id"</span><span class="p">,</span> 
            <span class="s2">"do_location_id"</span><span class="p">,</span> 
            <span class="s2">"round(abs(total_amount - caculated_total_amount), 2) AS amount_discrepancy"</span>
        <span class="p">)</span>

    <span class="c1"># === Adding alert ===</span>
    <span class="n">abnormal_fee_count</span> <span class="o">=</span> <span class="n">abnormal_fee</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">abnormal_fee_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">alert_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"‚ö†Ô∏è </span><span class="si">{</span><span class="n">abnormal_fee_count</span><span class="si">}</span><span class="s2"> trips with abnormal fee detected."</span>

        <span class="n">send_email</span><span class="p">(</span>
            <span class="n">subject</span><span class="o">=</span><span class="s2">"Alert: Abnormal Trip Fee Detected"</span><span class="p">,</span>
            <span class="n">body</span><span class="o">=</span><span class="n">alert_message</span><span class="p">,</span>
            <span class="n">to_email</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">"email"</span><span class="p">][</span><span class="s2">"to_email"</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">alert_message</span><span class="p">)</span>

    <span class="n">query</span> <span class="o">=</span> <span class="n">abnormal_duration</span> \
        <span class="o">.</span><span class="n">writeStream</span> \
        <span class="o">.</span><span class="n">foreachBatch</span><span class="p">(</span><span class="n">process_abnormal_fee</span><span class="p">)</span> \
        <span class="o">.</span><span class="n">outputMode</span><span class="p">(</span><span class="s2">"append"</span><span class="p">)</span> \
        <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">"checkpointLocation"</span><span class="p">,</span> <span class="s2">"tmp/checkpoint/abnormal_fee"</span><span class="p">)</span> \
        <span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">query</span>
</code></pre></div></li>
<li>
<p>However, this approach caused a runtime error:
<img alt="Image" src="../img/error.png">
--&gt; This is because in Spark Structured Streaming, actions like <code>.count()</code> <strong>cannot be directly applied on streaming DataFrames</strong>, as the data flows continuously‚Äîunlike in batch processing where you can simply use <code>df.count()</code>. Instead, we need to process the data within a <code>foreachBatch</code> function, where each micro-batch is treated as a regular batch DataFrame. This enables us to safely use actions like .<code>count()</code> and apply custom logic.</p>
</li>
<li>
<p>The corrected implementation is as follows:
</p><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">detect_abnormal_fee</span><span class="p">(</span><span class="n">df_extra</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">process_abnormal_fee</span><span class="p">(</span><span class="n">batch_df</span><span class="p">,</span> <span class="n">epoch_id</span><span class="p">):</span>
        <span class="n">abnormal_fee</span> <span class="o">=</span> <span class="n">batch_df</span> \
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"caculated_total_amount"</span><span class="p">,</span> 
                        <span class="n">col</span><span class="p">(</span><span class="s2">"fare_amount"</span><span class="p">)</span> <span class="o">+</span>
                        <span class="n">col</span><span class="p">(</span><span class="s2">"extra"</span><span class="p">)</span> <span class="o">+</span>
                        <span class="n">col</span><span class="p">(</span><span class="s2">"mta_tax"</span><span class="p">)</span> <span class="o">+</span>
                        <span class="n">col</span><span class="p">(</span><span class="s2">"tip_amount"</span><span class="p">)</span> <span class="o">+</span>
                        <span class="n">col</span><span class="p">(</span><span class="s2">"tolls_amount"</span><span class="p">)</span> <span class="o">+</span>
                        <span class="n">col</span><span class="p">(</span><span class="s2">"improvement_surcharge"</span><span class="p">)</span> <span class="o">+</span>
                        <span class="n">col</span><span class="p">(</span><span class="s2">"airport_fee"</span><span class="p">))</span> \
            <span class="o">.</span><span class="n">filter</span><span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"total_amount"</span><span class="p">)</span> <span class="o">-</span> <span class="n">col</span><span class="p">(</span><span class="s2">"caculated_total_amount"</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"total_amount"</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">()))</span> \
            <span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span>
                <span class="s2">"pickup_datetime"</span><span class="p">,</span> 
                <span class="s2">"dropoff_datetime"</span><span class="p">,</span> 
                <span class="s2">"pu_location_id"</span><span class="p">,</span> 
                <span class="s2">"do_location_id"</span><span class="p">,</span> 
                <span class="s2">"round(abs(total_amount - caculated_total_amount), 2) AS amount_discrepancy"</span>
            <span class="p">)</span>

        <span class="c1"># === Adding alert ===</span>
        <span class="n">abnormal_fee_count</span> <span class="o">=</span> <span class="n">abnormal_fee</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">abnormal_fee_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">alert_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"‚ö†Ô∏è </span><span class="si">{</span><span class="n">abnormal_fee_count</span><span class="si">}</span><span class="s2"> trips with abnormal fee detected."</span>

            <span class="n">send_email</span><span class="p">(</span>
                <span class="n">subject</span><span class="o">=</span><span class="s2">"Alert: Abnormal Trip Fee Detected"</span><span class="p">,</span>
                <span class="n">body</span><span class="o">=</span><span class="n">alert_message</span><span class="p">,</span>
                <span class="n">to_email</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">"email"</span><span class="p">][</span><span class="s2">"to_email"</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">alert_message</span><span class="p">)</span>

        <span class="n">foreach_batch_jdbc_writer</span><span class="p">(</span><span class="n">abnormal_fee</span><span class="p">,</span> <span class="n">epoch_id</span><span class="p">,</span> <span class="s2">"abnormal_fee"</span><span class="p">)</span>


    <span class="n">query</span> <span class="o">=</span> <span class="n">df_extra</span> \
        <span class="o">.</span><span class="n">writeStream</span> \
        <span class="o">.</span><span class="n">foreachBatch</span><span class="p">(</span><span class="n">process_abnormal_fee</span><span class="p">)</span> \
        <span class="o">.</span><span class="n">outputMode</span><span class="p">(</span><span class="s2">"append"</span><span class="p">)</span> \
        <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">"checkpointLocation"</span><span class="p">,</span> <span class="s2">"tmp/checkpoint/abnormal_fee"</span><span class="p">)</span> \
        <span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">query</span>
</code></pre></div>
</li>
</ul>
<hr>
</li>
<li>
<p>The function <code>avg_revenue_per_hour</code> is used to calculate the average revenue per hour, grouped by <em>payment type</em>.
</p><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">avg_revenue_per_hour</span><span class="p">(</span><span class="n">df_main</span><span class="p">):</span>    
    <span class="n">avg_revenue_per_hour</span> <span class="o">=</span> <span class="n">df_main</span> \
        <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"total_amount"</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">())</span> \
        <span class="o">.</span><span class="n">withWatermark</span><span class="p">(</span><span class="s2">"pickup_datetime"</span><span class="p">,</span> <span class="s2">"60 minutes"</span><span class="p">)</span> \
        <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="n">window</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"pickup_datetime"</span><span class="p">),</span> <span class="s2">"60 minutes"</span><span class="p">))</span> \
        <span class="o">.</span><span class="n">agg</span><span class="p">(</span>
            <span class="n">avg</span><span class="p">(</span><span class="s2">"total_amount"</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"total_amount"</span><span class="p">),</span>
            <span class="n">avg</span><span class="p">(</span><span class="n">expr</span><span class="p">(</span><span class="s2">"CASE WHEN payment_type = 1 THEN total_amount END"</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"credit_card"</span><span class="p">),</span>
            <span class="n">avg</span><span class="p">(</span><span class="n">expr</span><span class="p">(</span><span class="s2">"CASE WHEN payment_type = 2 THEN total_amount END"</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"cash"</span><span class="p">)</span>
        <span class="p">)</span> \
        <span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span>
            <span class="s2">"cast(date_format(window.start, 'yyyy-MM-dd') as date) AS date"</span><span class="p">,</span>
            <span class="s2">"date_format(window.start, 'HH:mm:ss') AS start_time"</span><span class="p">,</span>
            <span class="s2">"date_format(window.end, 'HH:mm:ss') AS end_time"</span><span class="p">,</span>
            <span class="s2">"round(total_amount, 2) AS total_amount"</span><span class="p">,</span>
            <span class="s2">"round(credit_card, 2) AS credit_card"</span><span class="p">,</span>
            <span class="s2">"round(cash, 2) AS cash"</span>
        <span class="p">)</span> \
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">"window"</span><span class="p">)</span>

    <span class="n">query</span> <span class="o">=</span> <span class="n">avg_revenue_per_hour</span> \
        <span class="o">.</span><span class="n">writeStream</span> \
        <span class="o">.</span><span class="n">foreachBatch</span><span class="p">(</span><span class="k">lambda</span> <span class="n">df</span><span class="p">,</span> <span class="n">epoch_id</span><span class="p">:</span> <span class="n">foreach_batch_jdbc_writer</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">epoch_id</span><span class="p">,</span> <span class="s2">"avg_revenue_per_hour"</span><span class="p">))</span> \
        <span class="o">.</span><span class="n">outputMode</span><span class="p">(</span><span class="s2">"append"</span><span class="p">)</span> \
        <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">"checkpointLocation"</span><span class="p">,</span> <span class="s2">"tmp/checkpoint/avg_revenue"</span><span class="p">)</span> \
        <span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">query</span>
</code></pre></div>
</li>
</ol>
<hr>
<ol>
<li>The function <code>calculate_trip_count_per_zone</code> is used to count the number of trips per borough. We use the <code>ttaxi_zone_lookup.csv</code> file located in the <code>data/</code> folder as a reference for zone and borough mapping. To improve performance and avoid shuffling, a <code>broadcast join</code> is used‚Äîthis is especially effective when joining a large dataset with a smaller one.
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">caculate_trip_count_per_zone</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">df_extra</span><span class="p">):</span>
    <span class="n">taxi_zone_lookup_path</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"data/taxi_zone_lookup.csv"</span><span class="p">)</span>

    <span class="n">lookup_df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">taxi_zone_lookup_path</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inferSchema</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df_extra</span> <span class="o">=</span> <span class="n">df_extra</span> \
    <span class="o">.</span><span class="n">select</span><span class="p">(</span>
        <span class="s2">"pickup_datetime"</span><span class="p">,</span> <span class="s2">"dropoff_datetime"</span><span class="p">,</span> <span class="s2">"pu_location_id"</span>
    <span class="p">)</span>

    <span class="n">df_extra_with_location</span> <span class="o">=</span> <span class="n">df_extra</span> \
        <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">broadcast</span><span class="p">(</span><span class="n">lookup_df</span><span class="p">),</span> <span class="n">df_extra</span><span class="o">.</span><span class="n">pu_location_id</span> <span class="o">==</span> <span class="n">lookup_df</span><span class="o">.</span><span class="n">LocationID</span><span class="p">,</span> <span class="s2">"left"</span><span class="p">)</span> \
        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">df_extra</span><span class="p">[</span><span class="s2">"*"</span><span class="p">],</span> <span class="n">lookup_df</span><span class="p">[</span><span class="s2">"LocationID"</span><span class="p">],</span> <span class="n">lookup_df</span><span class="p">[</span><span class="s2">"Borough"</span><span class="p">])</span>

    <span class="n">trip_count_per_borough</span> <span class="o">=</span> <span class="n">df_extra_with_location</span> \
        <span class="o">.</span><span class="n">withWatermark</span><span class="p">(</span><span class="s2">"pickup_datetime"</span><span class="p">,</span> <span class="s2">"60 minutes"</span><span class="p">)</span> \
        <span class="o">.</span><span class="n">groupBy</span><span class="p">(</span>
            <span class="n">window</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">"pickup_datetime"</span><span class="p">),</span> <span class="s2">"60 minutes"</span><span class="p">),</span>
            <span class="s2">"Borough"</span>
        <span class="p">)</span> \
        <span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">count</span><span class="p">(</span><span class="s2">"pu_location_id"</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"total_trip"</span><span class="p">))</span> \
        <span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span>
            <span class="s2">"cast(date_format(window.start, 'yyyy-MM-dd') as date) AS date"</span><span class="p">,</span>
            <span class="s2">"date_format(window.start, 'HH:mm:ss') AS start_time"</span><span class="p">,</span>
            <span class="s2">"date_format(window.end, 'HH:mm:ss') AS end_time"</span><span class="p">,</span>
            <span class="s2">"Borough AS borough"</span><span class="p">,</span>
            <span class="s2">"total_trip"</span>
        <span class="p">)</span> \
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">"window"</span><span class="p">)</span>

    <span class="n">query</span> <span class="o">=</span> <span class="n">trip_count_per_borough</span> \
        <span class="o">.</span><span class="n">writeStream</span> \
        <span class="o">.</span><span class="n">outputMode</span><span class="p">(</span><span class="s2">"append"</span><span class="p">)</span> \
        <span class="o">.</span><span class="n">foreachBatch</span><span class="p">(</span><span class="k">lambda</span> <span class="n">df</span><span class="p">,</span> <span class="n">epoch_id</span><span class="p">:</span> <span class="n">foreach_batch_jdbc_writer</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">epoch_id</span><span class="p">,</span> <span class="s2">"trip_count_by_borough"</span><span class="p">))</span> \
        <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">"checkpointLocation"</span><span class="p">,</span> <span class="s2">"tmp/checkpoint/trip_count_by_borough"</span><span class="p">)</span> \
        <span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">query</span>
</code></pre></div></li>
</ol>
<hr>
<ul>
<li>
<p>Run Spark jobs:
</p><div class="highlight"><pre><span></span><code><span class="nv">$SPARK_HOME</span>/bin/spark-class.cmd<span class="w"> </span>org.apache.spark.deploy.master.Master
<span class="nv">$SPARK_HOME</span>/sbin/start-master.sh
</code></pre></div>
</li>
<li>
<p>Start a Spark worker:
</p><div class="highlight"><pre><span></span><code><span class="nv">$SPARK_HOME</span>/bin/spark-class.cmd<span class="w"> </span>org.apache.spark.deploy.worker.Worker<span class="w"> </span>spark://HOST:PORT
<span class="nv">$SPARK_HOME</span>/sbin/start-slave.sh<span class="w"> </span>spark://HOST:PORT
</code></pre></div>
</li>
<li>
<p>Submit Spark jobs:
</p><div class="highlight"><pre><span></span><code><span class="nv">$YOUR_PROJECT_DIRECTORY</span>/spark-submit<span class="w"> </span><span class="se">\</span>
--master<span class="w"> </span>spark://HOST:PORT<span class="w"> </span><span class="se">\</span>
--num-executors<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
--executor-memory<span class="w"> </span>5G<span class="w"> </span><span class="se">\</span>
--total-executor-cores<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="se">\</span>
--packages<span class="w"> </span>org.apache.spark:spark-sql-kafka-0-10_2.12:3.5.1,org.postgresql:postgresql:42.5.4,org.apache.kafka:kafka-clients:3.7.0<span class="w"> </span><span class="se">\</span>
--driver-class-path<span class="w"> </span>/path-to-your-jar/postgresql-x.x.x.jar<span class="w"> </span><span class="se">\</span>
src/spark_streaming.py
</code></pre></div>
</li>
</ul>
<p>If there are no errors, you can then query the data in pgAdmin4. For a step-by-step tutorial, refer to the <a href="#execution-overview">Execution Overview üé¨</a></p>
<h2 id="summary"><strong>Summary</strong></h2>
<p>Throughout this guide, we‚Äôve thoroughly examined each component of the pipeline, setting up Kafka for data streaming, from processing data with Spark to storing it in PostgreSQL. The incorporation of Docker simplifies the Kafka setup.</p>
<p>It's important to note that while this setup is ideal for learning and small-scale projects, scaling it for production use would require additional considerations, particularly regarding security and performance optimization. Future enhancements could include integrating advanced data processing techniques,expanding the pipeline to incorporate more complex data sources.</p>
<p>Thank you very much for following along with me. If you have any questions, feel free to inbox me. I hope you enjoy working on the project. Thank you!</p></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.expand", "navigation.sections", "navigation.top", "content.code.copy", "content.code.select", "content.code.annotate"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>